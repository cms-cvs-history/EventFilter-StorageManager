<?xml version='1.0'?>
<xc:Partition xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
              xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" 
              xmlns:xc="http://xdaq.web.cern.ch/xdaq/xsd/2004/XMLConfiguration-30">

    <i2o:protocol xmlns:i2o="http://xdaq.web.cern.ch/xdaq/xsd/2004/I2OConfiguration-30">
       <i2o:target class="evf::FUEventProcessor" instance="0" tid="23"/>
       <i2o:target class="SMi2oSender" instance="0" tid="25"/>
       <i2o:target class="testStorageManager" instance="0" tid="24"/>
    </i2o:protocol>

   <xc:Context url="http://192.168.198.92:1972">
       <xc:Endpoint protocol="tcp" service="i2o"
          hostname="192.168.198.92" port="30000" network="tcp1"/>
	<xc:Application class="Executive" id="0" network="local" resident="true">		 	
		<properties xmlns="urn:xdaq-application:Executive" xsi:type="soapenc:Struct">
                      <logLevel xsi:type="xsd:string">INFO</logLevel>
                </properties>
	</xc:Application>

        <xc:Application class="evf::FUEventProcessor" id="21" instance="0" network="tcp1">
           <properties xmlns="urn:xdaq-application:FUEventProcessor" xsi:type="soapenc:Struct">

                    <parameterSet xsi:type="xsd:string">
		       process TEST1 = {
		         path p = { m1, a1 }
                         endpath e = { out2 }
                         source = EmptySource {untracked int32 maxEvents = 50}
                         module m1 = StreamThingProducer {
                           int32 array_size = 20000
                           int32 instance_count=11}
                         module a1 = StreamThingAnalyzer { string product_to_get="m1" }
                         module out2 = I2OTestConsumer {
                           int32 max_event_size = 2000000 int32 max_queue_depth = 5 
                           PSet consumer_config = { 
                             # untracked int32 i2o_max_size = 262140
                             string DestinationName = "testStorageManager" } 
                         }
                       }
                    </parameterSet>
                  </properties>

                </xc:Application>
       <xc:Application class="SMi2oSender" id="20" instance="0" network="tcp1">
       </xc:Application>
       <xc:Application class="PeerTransportTCP" id="30" network="tcp1">
           <properties xmlns="urn:xdaq-application:PeerTransportTCP" xsi:type="soapenc:Struct">
              <autoSize xsi:type="xsd:boolean">true</autoSize>
              <maxPacketSize xsi:type="xsd:unsignedLong">262144</maxPacketSize>
              <!-- poolName xsi:type="xsd:string">RoundtripSendPool</poolName -->
           </properties>
       </xc:Application>
       <xc:Module>/uscmst1/prod/sw/cms/external/xdaq/XDAQ_3_4/slc3_ia32_gcc323/lib/linux/x86/libptatcp.so</xc:Module>
       <xc:Module>/cmsonline/home/cheung/cms/CMSSW_0_6_0/lib/slc3_ia32_gcc323/libEventFilterProcessor.so</xc:Module>
       <xc:Module>/cmsonline/home/cheung/cms/CMSSW_0_6_0/lib/slc3_ia32_gcc323/libEventFilterStorageManager.so</xc:Module>
   </xc:Context>

    <!-- Declare a context that contain applcation -->
    <xc:Context id = "1" url="http://192.168.198.91:1972">
       <xc:Endpoint protocol="tcp" service="i2o"
          hostname="192.168.198.91" port="60000" network="tcp1"/>

       <!-- Declare a SMSender application -->
       <xc:Application class="testStorageManager" id="29" instance="0" network="tcp1">
<properties xmlns="urn:xdaq-application:testStorageManager" xsi:type="soapenc:Struct">
                    <FUparameterSet xsi:type="xsd:string">
                       process TEST1 = {
                         path p = { m1, a1 }
                         source = EmptySource {untracked int32 maxEvents = 50}
                         module m1 = StreamThingProducer {
                           int32 array_size = 20000
                           int32 instance_count=11}
                         module a1 = StreamThingAnalyzer { string product_to_get="m1" }
                         module out2 = I2OTestConsumer {
                           int32 max_event_size = 2000000 int32 max_queue_depth = 5
                           PSet consumer_config = { 
                             # untracked int32 i2o_max_size = 262140
                             string DestinationName = "testStorageManager" } 
                         }
                       }
                    </FUparameterSet>
                    <STparameterSet xsi:type="xsd:string">
                      process PROD  = {
                       untracked PSet options = { untracked bool wantSummary = true }

                       service = SillyLockService {
                         untracked vstring labels = { "outA", "outB" , "outC" } }
                       source = FragmentInput { }
                       module a1 = StreamThingAnalyzer { string product_to_get="m1" }

                       module pre1 = Prescaler { int32 prescaleFactor = 5 }
                       module pre2 = Prescaler { int32 prescaleFactor = 2 }

                       path p1 = { a1 }
                       path p2 = { pre1 }
                       path p3 = { pre2 }

                       module outA = PoolOutputModule {
                        untracked string fileName = "mysmoutA.root" }
                       module outB = PoolOutputModule {
                        untracked PSet SelectEvents = { vstring SelectEvents={"p2"}}
                        untracked string fileName = "mysmoutB.root" }
                       module outC = PoolOutputModule {
                        untracked string fileName = "mysmoutC.root" }

                       endpath e1 = { outA }
                       endpath e2 = { outB }
                       endpath e3 = { pre2, outC }
                     }
                    </STparameterSet>
                    <oneinN xsi:type="xsd:integer">5</oneinN>
                    <runNumber xsi:type="xsd:unsignedLong">1</runNumber>
</properties>

       </xc:Application>
       <xc:Application class="PeerTransportTCP" id="31" network="tcp1">
           <properties xmlns="urn:xdaq-application:PeerTransportTCP" xsi:type="soapenc:Struct">
              <autoSize xsi:type="xsd:boolean">true</autoSize>
              <maxPacketSize xsi:type="xsd:unsignedLong">262144</maxPacketSize>
           </properties>
       </xc:Application>

       <xc:Module>/uscmst1/prod/sw/cms/external/xdaq/XDAQ_3_4/slc3_ia32_gcc323/lib/linux/x86/libptatcp.so</xc:Module>
       <xc:Module>/cmsonline/home/cheung/cms/CMSSW_0_6_0/lib/slc3_ia32_gcc323/libEventFilterStorageManagertestStorageManager.so</xc:Module>
       </xc:Context>

</xc:Partition>
